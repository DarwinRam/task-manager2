<div class="centered-block">
 
  <%- include('partials/header') %>
  
  
  <section class="task-form-section">
    <% if (errors && errors.length > 0) { %>
      <ul class="form-errors">
        <% errors.forEach(error => { %>
          <li><%= error.msg || error %></li>
        <% }) %>
      </ul>
    <% } %>
  
    <!-- ‚ûï Add Task Form -->
    <div class="card-form add-task-card">
  
      
  
      <form action="<%= editMode ? `/tasks/${editId}?_method=PUT` : '/tasks' %>" method="POST" class="add-task-form">
        <h2><%= editMode ? 'Edit Task' : 'Add a New Task' %></h2>
      
      
        <input type="text" name="title" placeholder="üìù Task title"
          value="<%= formData?.title || '' %>"
  
          class="<%= errors && errors.some(e => e.msg.toLowerCase().includes('title')) ? 'input-error' : '' %>" />
      
        <textarea name="description" placeholder="üìå Optional description"><%= formData?.description || '' %></textarea>
      
      
        <div id="form-errors" class="error-message-list" style="display: none;"></div>
  
        <label for="priority">üìä Priority</label>
  <select name="priority" id="priority-select">
    <option value="Low" <%= formData.priority === 'Low' ? 'selected' : '' %>>üü¢ Low</option>
    <option value="Medium" <%= formData.priority === 'Medium' ? 'selected' : '' %>>üü† Medium</option>
    <option value="High" <%= formData.priority === 'High' ? 'selected' : '' %>>üî¥ High</option>
  </select>    
      
        <button type="submit"><%= editMode ? 'üíæ Save Changes' : '‚ûï Add Task' %></button>
        <% if (editMode) { %>
          <a href="/" class="cancel-edit-btn" role="button">Cancel</a>
        <% } %>      
  
        </form>
      
    </div>
  </section>
  
  <!-- üîç Search Form -->
  <div class="card-form search-card">
    <form method="GET" action="/" class="search-form">
      <div class="form-group">
        <input type="text" name="search" placeholder="üîç Search tasks..." value="<%= search %>" />
        <button type="submit">Search</button>
      </div>
    </form>
  </div>
  </div>
  
  <!-- Filter Buttons -->
  <div class="filter-buttons">
    <a href="/?filter=all&search=<%= search %>" class="<%= filter === 'all' ? 'active' : '' %>">All</a>
    <a href="/?filter=completed&search=<%= search %>" class="<%= filter === 'completed' ? 'active' : '' %>">Completed</a>
    <a href="/?filter=incomplete&search=<%= search %>" class="<%= filter === 'incomplete' ? 'active' : '' %>">Incomplete</a>
  </div>
  
  <section class="task-list">
    <% if (tasks.length === 0) { %>
      <p class="no-tasks">No tasks yet. Start by adding one above!</p>
    <% } else { %>
      <div class="task-grid">
        <% tasks.forEach((task, index) => { %>
          <div class="task-card <%= task.completed ? 'completed' : '' %>">
            <div class="task-card-header">
              <h3><%= index + 1 %>. <%= task.title %></h3>
            </div>
            <div class="task-card-body">
              <% if (task.description) { %>
                <p><%= task.description %></p>
              <% } %>
              <p class="status">Status: <%= task.completed ? '‚úÖ Completed' : '‚ùå Incomplete' %></p>
            </div>
            <div class="task-card-actions">
              <form action="/tasks/<%= task.id %>?_method=PATCH" method="POST">
                <button type="submit"><%= task.completed ? 'üîÅ Incomplete' : '‚úîÔ∏è Complete' %></button>
              </form>
              <form action="/tasks/<%= task.id %>?_method=DELETE" method="POST">
                <button type="submit">üóëÔ∏è Delete</button>
              </form>        
             
  <span class="priority-badge <%= task.priority.toLowerCase() %>"> Priority: 
    <%= task.priority === 'Low' ? 'üü¢ L' : task.priority === 'Medium' ? 'üü† M' : 'üî¥ H' %>
  </span>
  
              <form action="/" method="GET">
                <input type="hidden" name="edit" value="<%= task.id %>">
                <input type="hidden" name="search" value="<%= search %>">
                <input type="hidden" name="filter" value="<%= filter %>">
                <button type="submit">‚úèÔ∏è Edit</button>
              </form>                
              
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </section>
  
  <footer class="centered-block">
    <%- include('partials/footer') %>  
  </footer>
  
  
  